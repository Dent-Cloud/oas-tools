{"version":3,"file":"index.mjs","names":["_","express","utils","EmptyMiddleware","OASAuth","OASRouter","OASSecurity","OASValidator","ZSchema","bodyParser","config","deref","fs","join","jsyaml","request","validator","ignoreUnresolvableReferences","ignoreUnknownFormats","breakOnFirstError","schemaV3","safeLoad","readFileSync","__dirname","fatalError","err","logger","error","init_checks","specDoc","callback","isUndefined","Error","isPlainObject","TypeError","isFunction","validate","JSON","stringify","getLastErrors","info","configure","options","setConfigurations","checkOperationId","load","pathName","methodName","methodSection","opId","undefined","rawOpId","has","operationId","generateName","toUpperCase","debug","checkControllers","controllersLocation","controller","router_property","require","getExpressVersion","oasPath","replace","appendBasePath","expressPath","res","servers","specServer","url","split","basePath","charAt","length","slice","i","extendGrants","grantsFile","newGrants","Object","keys","forEach","role","resource","grants","splitRes","paths","specPath","found","pos","splitPath","resPart","foundPos","indexOf","$extend","isJWTScheme","secDef","type","scheme","bearerFormat","initializeSecurityAndAuth","components","securitySchemes","securityFile","secName","substr","_err","_res","body","parse","process","cwd","registerPaths","app","OASRouterMid","call","controllers","OASValidatorMid","OASSecurityMid","OASAuthMid","dictionary","localServer","find","server","foundServer","push","allowedMethods","path","method","includes","myPathObj","hasOwnProperty","toString","router","oasSecurity","oasAuth","docs","apiDocs","apiDocsPrefix","apiSpecDoc","freeze","cloneDeep","use","_req","send","swaggerUi","uiHtml","writeFileSync","swaggerUiPrefix","static","pathsDict","initialize","oasDoc","fullSchema","mergeAdditionalProperties","initializeMiddleware","json","strict","middleware","swaggerValidator","swaggerRouter","swaggerMetadata","swaggerSecurity"],"sources":["../src/index.js"],"sourcesContent":["/*\nOAS-tools module 0.0.0, built on: 2017-03-30\nCopyright (C) 2017 Ignacio Peluaga Lozada (ISA Group)\nhttps://github.com/ignpelloz\nhttps://github.com/isa-group/project-oas-tools\n*/\n\nimport * as _ from \"lodash-compat\";\nimport * as express from \"express\";\nimport * as utils from \"./lib/utils\";\nimport EmptyMiddleware from \"./middleware/empty_middleware\";\nimport OASAuth from \"./middleware/oas-auth\";\nimport OASRouter from \"./middleware/oas-router\";\nimport OASSecurity from \"./middleware/oas-security\";\nimport OASValidator from \"./middleware/oas-validator\";\nimport ZSchema from \"z-schema\";\nimport bodyParser from \"body-parser\";\nimport { config } from \"./configurations\";\nimport deref from \"json-schema-deref-sync\";\nimport fs from \"fs\";\nimport { join } from \"path\";\nimport jsyaml from \"js-yaml\";\nimport request from \"request\";\n\nconst validator = new ZSchema({\n  ignoreUnresolvableReferences: true,\n  ignoreUnknownFormats: config.ignoreUnknownFormats,\n  breakOnFirstError: false,\n});\nconst schemaV3 = jsyaml.safeLoad(\n  fs.readFileSync(join(__dirname, \"./schemas/openapi-3.0.yaml\"), \"utf8\")\n);\n\nfunction fatalError(err) {\n  config.logger.error(err);\n  throw err;\n}\n\n/**\n * Checks that specDoc and callback exist and validates specDoc.\n *@param {object} specDoc - Speceficitation file.\n *@param {object} callback - Callback function passed to the initialization function.\n */\nexport function init_checks(specDoc, callback) {\n  if (_.isUndefined(specDoc)) {\n    throw new Error(\"specDoc is required\");\n  } else if (!_.isPlainObject(specDoc)) {\n    throw new TypeError(\"specDoc must be an object\");\n  }\n\n  if (_.isUndefined(callback)) {\n    throw new Error(\"callback is required\");\n  } else if (!_.isFunction(callback)) {\n    throw new TypeError(\"callback must be a function\");\n  }\n\n  var err = validator.validate(specDoc, schemaV3);\n  if (err == false) {\n    fatalError(\n      \"Specification file is not valid: \" +\n        JSON.stringify(validator.getLastErrors())\n    );\n  } else {\n    config.logger.info(\"Valid specification file\");\n  }\n}\n\n/**\n * Function to set configurations. Initializes local variables that then will be used in the callback inside initializeMiddleware function.\n *@param {object} options - Parameter containing controllers location, enable logs, and strict checks. It can be a STRING or an OBJECT.\n */\nexport function configure(options) {\n  config.setConfigurations(options);\n}\n\n/**\n * Checks if operationId (or generic) and function for it exists on controller for a given pair path-method.\n *@param {object} load - Loaded controller.\n *@param {object} pathName - Path of the spec file to be used to find controller.\n *@param {object} methodName - One of CRUD methods.\n *@param {object} methodSection - Section of the speficication file belonging to methodName.\n */\nfunction checkOperationId(load, pathName, methodName, methodSection) {\n  var opId = undefined;\n  var rawOpId = undefined;\n\n  if (_.has(methodSection, \"operationId\")) {\n    rawOpId = methodSection.operationId;\n    opId = utils.generateName(rawOpId, undefined); //there is opId: just normalize\n  }\n\n  if (opId == undefined) {\n    opId = utils.generateName(pathName, \"function\") + methodName.toUpperCase(); //there is no opId: normalize and add \"func\" at the beggining\n    config.logger.debug(\n      \"      There is no operationId for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \" -> generated: \" +\n        opId\n    );\n  }\n\n  if (load[opId] == undefined) {\n    fatalError(\n      \"      There is no function in the controller for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \" (operationId: \" +\n        opId +\n        \")\"\n    );\n  } else {\n    config.logger.debug(\n      \"      Controller for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \": OK\"\n    );\n  }\n}\n\n/**\n * Checks if exists controller for a given pair path-method.\n *@param {object} pathName - Path of the spec file to be used to find controller.\n *@param {object} methodName - One of CRUD methods.\n *@param {object} methodSection - Section of the speficication file belonging to methodName.\n *@param {object} controllersLocation - Location of controller files.\n */\nfunction checkControllers(\n  pathName,\n  methodName,\n  methodSection,\n  controllersLocation\n) {\n  config.logger.debug(\"  \" + methodName.toUpperCase() + \" - \" + pathName);\n  var controller;\n  var load;\n  var router_property;\n\n  if (methodSection[\"x-router-controller\"] != undefined) {\n    router_property = \"x-router-controller\";\n  } else if (methodSection[\"x-swagger-router-controller\"] != undefined) {\n    router_property = \"x-swagger-router-controller\";\n  } else {\n    router_property = undefined;\n  }\n\n  if (methodSection[router_property] != undefined) {\n    controller = methodSection[router_property];\n    config.logger.debug(\n      \"    OAS-doc has \" + router_property + \" property \" + controller\n    );\n    try {\n      load = require(join(\n        controllersLocation,\n        utils.generateName(controller, undefined)\n      ));\n      checkOperationId(load, pathName, methodName, methodSection);\n    } catch (err) {\n      fatalError(err);\n    }\n  } else {\n    controller = utils.generateName(pathName, \"controller\");\n    config.logger.debug(\n      \"    Spec-file does not have router property -> try generic controller name: \" +\n        controller\n    );\n    try {\n      load = require(join(controllersLocation, controller));\n      checkOperationId(load, pathName, methodName, methodSection);\n    } catch (err) {\n      config.logger.debug(\n        \"    Controller with generic controller name wasn't found either -> try Default one\"\n      );\n      try {\n        controller = \"Default\"; //try to load default one\n        load = require(join(controllersLocation, controller));\n        checkOperationId(load, pathName, methodName, methodSection);\n      } catch (err) {\n        fatalError(\n          \"    There is no controller for \" +\n            methodName.toUpperCase() +\n            \" - \" +\n            pathName\n        );\n      }\n    }\n  }\n}\n\n/**\n * Converts a oas-doc type path into an epxress one.\n * @param {string} oasPath - Path as shown in the oas-doc.\n */\nvar getExpressVersion = function (oasPath) {\n  return oasPath.replace(/{/g, \":\").replace(/}/g, \"\");\n};\n\n/**\n * In case the spec doc has servers.url properties this function appends the base path to the path before registration\n * @param {string} specDoc - Specification file.\n * @param {string} expressPath - Express type path.\n */\nfunction appendBasePath(specDoc, expressPath) {\n  var res;\n  if (specDoc.servers != undefined) {\n    var specServer = specDoc.servers[0].url;\n    var url = specServer.split(\"/\");\n\n    var basePath = \"/\";\n\n    if (specServer.charAt(0) === \"/\") {\n      basePath =\n        specServer.charAt(specServer.length - 1) !== \"/\"\n          ? specServer\n          : specServer.slice(0, -1);\n    } else {\n      for (var i = 0; i < url.length; i++) {\n        if (i >= 3) {\n          basePath += url[i] + \"/\";\n        }\n      }\n      basePath = basePath.slice(0, -1);\n      if (basePath == \"/\") {\n        basePath = \"\";\n      }\n    }\n    config.basePath = basePath;\n    res = basePath + expressPath;\n  } else {\n    res = expressPath;\n  }\n\n  return res;\n}\n\nfunction extendGrants(specDoc, grantsFile) {\n  var newGrants = {};\n  Object.keys(grantsFile).forEach((role) => {\n    newGrants[role] = {};\n    Object.keys(grantsFile[role]).forEach((resource) => {\n      if (resource !== \"$extend\") {\n        var grants = grantsFile[role][resource];\n        var splitRes = resource.split(\"/\");\n        Object.keys(specDoc.paths).forEach((specPath) => {\n          var found = true;\n          var pos = -1;\n          var splitPath = specPath.split(\"/\");\n          splitRes.forEach((resPart) => {\n            var foundPos = splitPath.indexOf(resPart);\n            if (!found || foundPos <= pos) {\n              found = false;\n            }\n          });\n          if (found && !newGrants[role][specPath]) {\n            newGrants[role][specPath] = grants;\n          }\n        });\n      } else {\n        newGrants[role].$extend = grantsFile[role].$extend;\n      }\n    });\n  });\n  return newGrants;\n}\n\nfunction isJWTScheme(secDef) {\n  return (\n    secDef.type === \"http\" &&\n    secDef.scheme === \"bearer\" &&\n    secDef.bearerFormat === \"JWT\"\n  );\n}\n\nfunction initializeSecurityAndAuth(specDoc) {\n  if (specDoc.components && specDoc.components.securitySchemes) {\n    if (!config.securityFile) {\n      config.securityFile = {};\n    }\n    if (!config.grantsFile) {\n      config.grantsFile = {};\n    }\n    Object.keys(specDoc.components.securitySchemes).forEach((secName) => {\n      var secDef = specDoc.components.securitySchemes[secName];\n      if (isJWTScheme(secDef)) {\n        if (secDef[\"x-bearer-config\"] && !config.securityFile[secName]) {\n          config.securityFile[secName] = secDef[\"x-bearer-config\"];\n        }\n        if (secDef[\"x-acl-config\"] && !config.grantsFile[secName]) {\n          config.grantsFile[secName] = secDef[\"x-acl-config\"];\n        }\n      }\n    });\n    Object.keys(config.securityFile).forEach((secName) => {\n      if (\n        typeof config.securityFile[secName] === \"string\" &&\n        isJWTScheme(specDoc.components.securitySchemes[secName])\n      ) {\n        if (config.securityFile[secName].substr(0, 4) === \"http\") {\n          request(config.securityFile[secName], (_err, _res, body) => {\n            config.securityFile[secName] = JSON.parse(body);\n          });\n        } else if (config.securityFile[secName].charAt(0) === \"/\") {\n          config.securityFile[secName] = require(config.securityFile[secName]);\n        } else {\n          config.securityFile[secName] = require(join(\n            process.cwd(),\n            config.securityFile[secName]\n          ));\n        }\n      }\n    });\n    Object.keys(config.grantsFile).forEach((secName) => {\n      if (\n        typeof config.grantsFile[secName] === \"string\" &&\n        isJWTScheme(specDoc.components.securitySchemes[secName])\n      ) {\n        if (config.grantsFile[secName].substr(0, 4) === \"http\") {\n          request(config.grantsFile[secName], (_err, _res, body) => {\n            config.grantsFile[secName] = extendGrants(\n              specDoc,\n              JSON.parse(body)\n            );\n          });\n        } else if (config.grantsFile[secName].charAt(0) === \"/\") {\n          config.grantsFile[secName] = extendGrants(\n            specDoc,\n            require(config.grantsFile[secName])\n          );\n        } else {\n          config.grantsFile[secName] = extendGrants(\n            specDoc,\n            require(join(process.cwd(), config.grantsFile[secName]))\n          );\n        }\n      } else {\n        config.grantsFile[secName] = extendGrants(\n          specDoc,\n          config.grantsFile[secName]\n        );\n      }\n    });\n  }\n}\n\n/**\n * Function to initialize swagger-tools middlewares.\n *@param {object} specDoc - Specification file (dereferenced).\n *@param {function} app - Express application object.\n */\nfunction registerPaths(specDoc, app) {\n  var OASRouterMid = function () {\n    return OASRouter.call(undefined, config.controllers);\n  };\n  var OASValidatorMid = function () {\n    return OASValidator.call(undefined, specDoc);\n  };\n  initializeSecurityAndAuth(specDoc);\n  var OASSecurityMid = function () {\n    return OASSecurity.call(undefined, specDoc);\n  };\n  var OASAuthMid = function () {\n    return OASAuth.call(undefined, specDoc);\n  };\n\n  var dictionary = {};\n\n  if (specDoc.servers) {\n    var localServer = specDoc.servers.find(\n      (server) =>\n        server.url.substr(0, 16) === \"http://localhost\" ||\n        server.url.charAt(0) === \"/\"\n    );\n    if (!localServer) {\n      config.logger.info(\n        \"No localhost or relative server found in spec file, added for testing in Swagger UI\"\n      );\n      var foundServer = specDoc.servers[0];\n      var basePath = \"/\" + foundServer.url.split(\"/\").slice(3).join(\"/\");\n      specDoc.servers.push({\n        url: basePath,\n      });\n    }\n  } else {\n    config.logger.info(\n      \"No servers found in spec file, added relative server for testing in Swagger UI\"\n    );\n    specDoc.servers = [\n      {\n        url: \"/\",\n      },\n    ];\n  }\n\n  var paths = specDoc.paths;\n  //  console.log('specDoc.paths ', specDoc.paths)\n  var allowedMethods = [\n    \"get\",\n    \"post\",\n    \"put\",\n    \"patch\",\n    \"delete\",\n    \"head\",\n    \"options\",\n    \"trace\",\n  ];\n  for (var path in paths) {\n    for (var method in paths[path]) {\n      if (allowedMethods.includes(method)) {\n        // pgillis 2019 June 10\n        var myPathObj = paths[path];\n        //console.log('myPathObj ', myPathObj)\n        //config.logger.debug('PWG ****: '+myPathObj+ \" hasProperty \"+  myPathObj.hasOwnProperty('x-swagger-router-controller'));\n        if (\n          myPathObj.hasOwnProperty(\"x-swagger-router-controller\") &&\n          myPathObj[method].hasOwnProperty(\"x-swagger-router-controller\") ===\n            false\n        ) {\n          myPathObj[method][\"x-swagger-router-controller\"] =\n            myPathObj[\"x-swagger-router-controller\"];\n        }\n        var expressPath = getExpressVersion(path); // TODO: take in account basePath/servers property of the spec doc.\n        dictionary[expressPath.toString()] = path;\n        config.logger.debug(\n          \"Register: \" + method.toUpperCase() + \" - \" + expressPath\n        );\n        if (config.router == true && config.checkControllers == true) {\n          checkControllers(\n            path,\n            method,\n            paths[path][method],\n            config.controllers\n          );\n        }\n        expressPath = appendBasePath(specDoc, expressPath);\n        if (config.oasSecurity == true) {\n          app[method](expressPath, OASSecurityMid());\n        }\n        if (config.oasAuth == true) {\n          app[method](expressPath, OASAuthMid());\n        }\n        if (config.validator == true) {\n          app[method](expressPath, OASValidatorMid());\n        }\n        if (config.router == true) {\n          app[method](expressPath, OASRouterMid());\n        }\n      }\n    }\n  }\n  if (config.docs && config.docs.apiDocs) {\n    if (!config.docs.apiDocsPrefix) {\n      config.docs.apiDocsPrefix = \"\";\n    }\n\n    const apiSpecDoc = Object.freeze(_.cloneDeep(specDoc));\n\n    app.use(config.docs.apiDocsPrefix + config.docs.apiDocs, (_req, res) => {\n      res.send(apiSpecDoc);\n    });\n    if (config.docs.swaggerUi) {\n      var uiHtml = fs.readFileSync(\n        join(__dirname, \"../swagger-ui/index.html\"),\n        \"utf8\"\n      );\n      uiHtml = uiHtml.replace(\n        /url: \"[^\"]*\"/,\n        'url: \"' + config.docs.apiDocsPrefix + config.docs.apiDocs + '\"'\n      );\n      fs.writeFileSync(\n        join(__dirname, \"../swagger-ui/index.html\"),\n        uiHtml,\n        \"utf8\"\n      );\n      if (!config.docs.swaggerUiPrefix) {\n        config.docs.swaggerUiPrefix = \"\";\n      }\n      app.use(\n        config.docs.swaggerUiPrefix + config.docs.swaggerUi,\n        express.static(join(__dirname, \"../swagger-ui\"))\n      );\n    }\n  }\n  config.pathsDict = dictionary;\n}\n\n/**\n * Function to initialize OAS-tools middlewares.\n *@param {object} oasDoc - Specification file.\n *@param {object} app - Express server used for the application. Needed to register the paths.\n *@param {function} callback - Function in which the app is started.\n */\nexport function initialize(oasDoc, app, callback) {\n  init_checks(oasDoc, callback);\n\n  var fullSchema = deref(oasDoc, { mergeAdditionalProperties: true });\n  config.logger.info(\"Specification file dereferenced\");\n\n  registerPaths(fullSchema, app);\n\n  callback();\n}\n\n/**\n * Function to initialize swagger-tools middlewares.\n *@param {object} specDoc - Specification file.\n *@param {function} app - //TODO IN CASE EXPRESS CAN BE USED INSTEAD OF CONNECT, USER MUST PASS THIS TO initializeMiddleware TO REGISTER ROUTES.\n *@param {function} callback - Function that initializes middlewares one by one.\n */\nexport function initializeMiddleware(specDoc, app, callback) {\n  app.use(\n    bodyParser.json({\n      strict: false,\n    })\n  );\n\n  init_checks(specDoc, callback);\n\n  var fullSchema = deref(specDoc);\n  config.logger.info(\"Specification file dereferenced\");\n\n  var middleware = {\n    swaggerValidator: EmptyMiddleware,\n    swaggerRouter: EmptyMiddleware,\n    swaggerMetadata: EmptyMiddleware,\n    swaggerUi: EmptyMiddleware,\n    swaggerSecurity: EmptyMiddleware,\n  };\n  registerPaths(fullSchema, app);\n  callback(middleware);\n}\n"],"mappings":"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"}