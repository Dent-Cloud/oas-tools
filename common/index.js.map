{"version":3,"file":"index.js","names":["_","_interopRequireWildcard","require","express","utils","_empty_middleware","_interopRequireDefault","_oasAuth","_oasRouter","_oasSecurity","_oasValidator","_zSchema","_bodyParser","_configurations","_jsonSchemaDerefSync","_fs","_path","_jsYaml","_request","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","validator","ZSchema","ignoreUnresolvableReferences","ignoreUnknownFormats","config","breakOnFirstError","schemaV3","jsyaml","safeLoad","fs","readFileSync","join","__dirname","fatalError","err","logger","error","init_checks","specDoc","callback","isUndefined","Error","isPlainObject","TypeError","isFunction","validate","JSON","stringify","getLastErrors","info","configure","options","setConfigurations","checkOperationId","load","pathName","methodName","methodSection","opId","undefined","rawOpId","operationId","generateName","toUpperCase","debug","checkControllers","controllersLocation","controller","router_property","getExpressVersion","oasPath","replace","appendBasePath","expressPath","res","servers","specServer","url","split","basePath","charAt","length","slice","i","extendGrants","grantsFile","newGrants","keys","forEach","role","resource","grants","splitRes","paths","specPath","found","pos","splitPath","resPart","foundPos","indexOf","$extend","isJWTScheme","secDef","type","scheme","bearerFormat","initializeSecurityAndAuth","components","securitySchemes","securityFile","secName","substr","request","_err","_res","body","parse","process","cwd","registerPaths","app","OASRouterMid","OASRouter","controllers","OASValidatorMid","OASValidator","OASSecurityMid","OASSecurity","OASAuthMid","OASAuth","dictionary","localServer","find","server","foundServer","push","allowedMethods","path","method","includes","myPathObj","toString","router","oasSecurity","oasAuth","docs","apiDocs","apiDocsPrefix","apiSpecDoc","freeze","cloneDeep","use","_req","send","swaggerUi","uiHtml","writeFileSync","swaggerUiPrefix","static","pathsDict","initialize","oasDoc","fullSchema","deref","mergeAdditionalProperties","initializeMiddleware","bodyParser","json","strict","middleware","swaggerValidator","EmptyMiddleware","swaggerRouter","swaggerMetadata","swaggerSecurity"],"sources":["../src/index.js"],"sourcesContent":["/*\nOAS-tools module 0.0.0, built on: 2017-03-30\nCopyright (C) 2017 Ignacio Peluaga Lozada (ISA Group)\nhttps://github.com/ignpelloz\nhttps://github.com/isa-group/project-oas-tools\n*/\n\nimport * as _ from \"lodash-compat\";\nimport * as express from \"express\";\nimport * as utils from \"./lib/utils\";\nimport EmptyMiddleware from \"./middleware/empty_middleware\";\nimport OASAuth from \"./middleware/oas-auth\";\nimport OASRouter from \"./middleware/oas-router\";\nimport OASSecurity from \"./middleware/oas-security\";\nimport OASValidator from \"./middleware/oas-validator\";\nimport ZSchema from \"z-schema\";\nimport bodyParser from \"body-parser\";\nimport { config } from \"./configurations\";\nimport deref from \"json-schema-deref-sync\";\nimport fs from \"fs\";\nimport { join } from \"path\";\nimport jsyaml from \"js-yaml\";\nimport request from \"request\";\n\nconst validator = new ZSchema({\n  ignoreUnresolvableReferences: true,\n  ignoreUnknownFormats: config.ignoreUnknownFormats,\n  breakOnFirstError: false,\n});\nconst schemaV3 = jsyaml.safeLoad(\n  fs.readFileSync(join(__dirname, \"./schemas/openapi-3.0.yaml\"), \"utf8\")\n);\n\nfunction fatalError(err) {\n  config.logger.error(err);\n  throw err;\n}\n\n/**\n * Checks that specDoc and callback exist and validates specDoc.\n *@param {object} specDoc - Speceficitation file.\n *@param {object} callback - Callback function passed to the initialization function.\n */\nexport function init_checks(specDoc, callback) {\n  if (_.isUndefined(specDoc)) {\n    throw new Error(\"specDoc is required\");\n  } else if (!_.isPlainObject(specDoc)) {\n    throw new TypeError(\"specDoc must be an object\");\n  }\n\n  if (_.isUndefined(callback)) {\n    throw new Error(\"callback is required\");\n  } else if (!_.isFunction(callback)) {\n    throw new TypeError(\"callback must be a function\");\n  }\n\n  var err = validator.validate(specDoc, schemaV3);\n  if (err == false) {\n    fatalError(\n      \"Specification file is not valid: \" +\n        JSON.stringify(validator.getLastErrors())\n    );\n  } else {\n    config.logger.info(\"Valid specification file\");\n  }\n}\n\n/**\n * Function to set configurations. Initializes local variables that then will be used in the callback inside initializeMiddleware function.\n *@param {object} options - Parameter containing controllers location, enable logs, and strict checks. It can be a STRING or an OBJECT.\n */\nexport function configure(options) {\n  config.setConfigurations(options);\n}\n\n/**\n * Checks if operationId (or generic) and function for it exists on controller for a given pair path-method.\n *@param {object} load - Loaded controller.\n *@param {object} pathName - Path of the spec file to be used to find controller.\n *@param {object} methodName - One of CRUD methods.\n *@param {object} methodSection - Section of the speficication file belonging to methodName.\n */\nfunction checkOperationId(load, pathName, methodName, methodSection) {\n  var opId = undefined;\n  var rawOpId = undefined;\n\n  if (_.has(methodSection, \"operationId\")) {\n    rawOpId = methodSection.operationId;\n    opId = utils.generateName(rawOpId, undefined); //there is opId: just normalize\n  }\n\n  if (opId == undefined) {\n    opId = utils.generateName(pathName, \"function\") + methodName.toUpperCase(); //there is no opId: normalize and add \"func\" at the beggining\n    config.logger.debug(\n      \"      There is no operationId for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \" -> generated: \" +\n        opId\n    );\n  }\n\n  if (load[opId] == undefined) {\n    fatalError(\n      \"      There is no function in the controller for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \" (operationId: \" +\n        opId +\n        \")\"\n    );\n  } else {\n    config.logger.debug(\n      \"      Controller for \" +\n        methodName.toUpperCase() +\n        \" - \" +\n        pathName +\n        \": OK\"\n    );\n  }\n}\n\n/**\n * Checks if exists controller for a given pair path-method.\n *@param {object} pathName - Path of the spec file to be used to find controller.\n *@param {object} methodName - One of CRUD methods.\n *@param {object} methodSection - Section of the speficication file belonging to methodName.\n *@param {object} controllersLocation - Location of controller files.\n */\nfunction checkControllers(\n  pathName,\n  methodName,\n  methodSection,\n  controllersLocation\n) {\n  config.logger.debug(\"  \" + methodName.toUpperCase() + \" - \" + pathName);\n  var controller;\n  var load;\n  var router_property;\n\n  if (methodSection[\"x-router-controller\"] != undefined) {\n    router_property = \"x-router-controller\";\n  } else if (methodSection[\"x-swagger-router-controller\"] != undefined) {\n    router_property = \"x-swagger-router-controller\";\n  } else {\n    router_property = undefined;\n  }\n\n  if (methodSection[router_property] != undefined) {\n    controller = methodSection[router_property];\n    config.logger.debug(\n      \"    OAS-doc has \" + router_property + \" property \" + controller\n    );\n    try {\n      load = require(join(\n        controllersLocation,\n        utils.generateName(controller, undefined)\n      ));\n      checkOperationId(load, pathName, methodName, methodSection);\n    } catch (err) {\n      fatalError(err);\n    }\n  } else {\n    controller = utils.generateName(pathName, \"controller\");\n    config.logger.debug(\n      \"    Spec-file does not have router property -> try generic controller name: \" +\n        controller\n    );\n    try {\n      load = require(join(controllersLocation, controller));\n      checkOperationId(load, pathName, methodName, methodSection);\n    } catch (err) {\n      config.logger.debug(\n        \"    Controller with generic controller name wasn't found either -> try Default one\"\n      );\n      try {\n        controller = \"Default\"; //try to load default one\n        load = require(join(controllersLocation, controller));\n        checkOperationId(load, pathName, methodName, methodSection);\n      } catch (err) {\n        fatalError(\n          \"    There is no controller for \" +\n            methodName.toUpperCase() +\n            \" - \" +\n            pathName\n        );\n      }\n    }\n  }\n}\n\n/**\n * Converts a oas-doc type path into an epxress one.\n * @param {string} oasPath - Path as shown in the oas-doc.\n */\nvar getExpressVersion = function (oasPath) {\n  return oasPath.replace(/{/g, \":\").replace(/}/g, \"\");\n};\n\n/**\n * In case the spec doc has servers.url properties this function appends the base path to the path before registration\n * @param {string} specDoc - Specification file.\n * @param {string} expressPath - Express type path.\n */\nfunction appendBasePath(specDoc, expressPath) {\n  var res;\n  if (specDoc.servers != undefined) {\n    var specServer = specDoc.servers[0].url;\n    var url = specServer.split(\"/\");\n\n    var basePath = \"/\";\n\n    if (specServer.charAt(0) === \"/\") {\n      basePath =\n        specServer.charAt(specServer.length - 1) !== \"/\"\n          ? specServer\n          : specServer.slice(0, -1);\n    } else {\n      for (var i = 0; i < url.length; i++) {\n        if (i >= 3) {\n          basePath += url[i] + \"/\";\n        }\n      }\n      basePath = basePath.slice(0, -1);\n      if (basePath == \"/\") {\n        basePath = \"\";\n      }\n    }\n    config.basePath = basePath;\n    res = basePath + expressPath;\n  } else {\n    res = expressPath;\n  }\n\n  return res;\n}\n\nfunction extendGrants(specDoc, grantsFile) {\n  var newGrants = {};\n  Object.keys(grantsFile).forEach((role) => {\n    newGrants[role] = {};\n    Object.keys(grantsFile[role]).forEach((resource) => {\n      if (resource !== \"$extend\") {\n        var grants = grantsFile[role][resource];\n        var splitRes = resource.split(\"/\");\n        Object.keys(specDoc.paths).forEach((specPath) => {\n          var found = true;\n          var pos = -1;\n          var splitPath = specPath.split(\"/\");\n          splitRes.forEach((resPart) => {\n            var foundPos = splitPath.indexOf(resPart);\n            if (!found || foundPos <= pos) {\n              found = false;\n            }\n          });\n          if (found && !newGrants[role][specPath]) {\n            newGrants[role][specPath] = grants;\n          }\n        });\n      } else {\n        newGrants[role].$extend = grantsFile[role].$extend;\n      }\n    });\n  });\n  return newGrants;\n}\n\nfunction isJWTScheme(secDef) {\n  return (\n    secDef.type === \"http\" &&\n    secDef.scheme === \"bearer\" &&\n    secDef.bearerFormat === \"JWT\"\n  );\n}\n\nfunction initializeSecurityAndAuth(specDoc) {\n  if (specDoc.components && specDoc.components.securitySchemes) {\n    if (!config.securityFile) {\n      config.securityFile = {};\n    }\n    if (!config.grantsFile) {\n      config.grantsFile = {};\n    }\n    Object.keys(specDoc.components.securitySchemes).forEach((secName) => {\n      var secDef = specDoc.components.securitySchemes[secName];\n      if (isJWTScheme(secDef)) {\n        if (secDef[\"x-bearer-config\"] && !config.securityFile[secName]) {\n          config.securityFile[secName] = secDef[\"x-bearer-config\"];\n        }\n        if (secDef[\"x-acl-config\"] && !config.grantsFile[secName]) {\n          config.grantsFile[secName] = secDef[\"x-acl-config\"];\n        }\n      }\n    });\n    Object.keys(config.securityFile).forEach((secName) => {\n      if (\n        typeof config.securityFile[secName] === \"string\" &&\n        isJWTScheme(specDoc.components.securitySchemes[secName])\n      ) {\n        if (config.securityFile[secName].substr(0, 4) === \"http\") {\n          request(config.securityFile[secName], (_err, _res, body) => {\n            config.securityFile[secName] = JSON.parse(body);\n          });\n        } else if (config.securityFile[secName].charAt(0) === \"/\") {\n          config.securityFile[secName] = require(config.securityFile[secName]);\n        } else {\n          config.securityFile[secName] = require(join(\n            process.cwd(),\n            config.securityFile[secName]\n          ));\n        }\n      }\n    });\n    Object.keys(config.grantsFile).forEach((secName) => {\n      if (\n        typeof config.grantsFile[secName] === \"string\" &&\n        isJWTScheme(specDoc.components.securitySchemes[secName])\n      ) {\n        if (config.grantsFile[secName].substr(0, 4) === \"http\") {\n          request(config.grantsFile[secName], (_err, _res, body) => {\n            config.grantsFile[secName] = extendGrants(\n              specDoc,\n              JSON.parse(body)\n            );\n          });\n        } else if (config.grantsFile[secName].charAt(0) === \"/\") {\n          config.grantsFile[secName] = extendGrants(\n            specDoc,\n            require(config.grantsFile[secName])\n          );\n        } else {\n          config.grantsFile[secName] = extendGrants(\n            specDoc,\n            require(join(process.cwd(), config.grantsFile[secName]))\n          );\n        }\n      } else {\n        config.grantsFile[secName] = extendGrants(\n          specDoc,\n          config.grantsFile[secName]\n        );\n      }\n    });\n  }\n}\n\n/**\n * Function to initialize swagger-tools middlewares.\n *@param {object} specDoc - Specification file (dereferenced).\n *@param {function} app - Express application object.\n */\nfunction registerPaths(specDoc, app) {\n  var OASRouterMid = function () {\n    return OASRouter.call(undefined, config.controllers);\n  };\n  var OASValidatorMid = function () {\n    return OASValidator.call(undefined, specDoc);\n  };\n  initializeSecurityAndAuth(specDoc);\n  var OASSecurityMid = function () {\n    return OASSecurity.call(undefined, specDoc);\n  };\n  var OASAuthMid = function () {\n    return OASAuth.call(undefined, specDoc);\n  };\n\n  var dictionary = {};\n\n  if (specDoc.servers) {\n    var localServer = specDoc.servers.find(\n      (server) =>\n        server.url.substr(0, 16) === \"http://localhost\" ||\n        server.url.charAt(0) === \"/\"\n    );\n    if (!localServer) {\n      config.logger.info(\n        \"No localhost or relative server found in spec file, added for testing in Swagger UI\"\n      );\n      var foundServer = specDoc.servers[0];\n      var basePath = \"/\" + foundServer.url.split(\"/\").slice(3).join(\"/\");\n      specDoc.servers.push({\n        url: basePath,\n      });\n    }\n  } else {\n    config.logger.info(\n      \"No servers found in spec file, added relative server for testing in Swagger UI\"\n    );\n    specDoc.servers = [\n      {\n        url: \"/\",\n      },\n    ];\n  }\n\n  var paths = specDoc.paths;\n  //  console.log('specDoc.paths ', specDoc.paths)\n  var allowedMethods = [\n    \"get\",\n    \"post\",\n    \"put\",\n    \"patch\",\n    \"delete\",\n    \"head\",\n    \"options\",\n    \"trace\",\n  ];\n  for (var path in paths) {\n    for (var method in paths[path]) {\n      if (allowedMethods.includes(method)) {\n        // pgillis 2019 June 10\n        var myPathObj = paths[path];\n        //console.log('myPathObj ', myPathObj)\n        //config.logger.debug('PWG ****: '+myPathObj+ \" hasProperty \"+  myPathObj.hasOwnProperty('x-swagger-router-controller'));\n        if (\n          myPathObj.hasOwnProperty(\"x-swagger-router-controller\") &&\n          myPathObj[method].hasOwnProperty(\"x-swagger-router-controller\") ===\n            false\n        ) {\n          myPathObj[method][\"x-swagger-router-controller\"] =\n            myPathObj[\"x-swagger-router-controller\"];\n        }\n        var expressPath = getExpressVersion(path); // TODO: take in account basePath/servers property of the spec doc.\n        dictionary[expressPath.toString()] = path;\n        config.logger.debug(\n          \"Register: \" + method.toUpperCase() + \" - \" + expressPath\n        );\n        if (config.router == true && config.checkControllers == true) {\n          checkControllers(\n            path,\n            method,\n            paths[path][method],\n            config.controllers\n          );\n        }\n        expressPath = appendBasePath(specDoc, expressPath);\n        if (config.oasSecurity == true) {\n          app[method](expressPath, OASSecurityMid());\n        }\n        if (config.oasAuth == true) {\n          app[method](expressPath, OASAuthMid());\n        }\n        if (config.validator == true) {\n          app[method](expressPath, OASValidatorMid());\n        }\n        if (config.router == true) {\n          app[method](expressPath, OASRouterMid());\n        }\n      }\n    }\n  }\n  if (config.docs && config.docs.apiDocs) {\n    if (!config.docs.apiDocsPrefix) {\n      config.docs.apiDocsPrefix = \"\";\n    }\n\n    const apiSpecDoc = Object.freeze(_.cloneDeep(specDoc));\n\n    app.use(config.docs.apiDocsPrefix + config.docs.apiDocs, (_req, res) => {\n      res.send(apiSpecDoc);\n    });\n    if (config.docs.swaggerUi) {\n      var uiHtml = fs.readFileSync(\n        join(__dirname, \"../swagger-ui/index.html\"),\n        \"utf8\"\n      );\n      uiHtml = uiHtml.replace(\n        /url: \"[^\"]*\"/,\n        'url: \"' + config.docs.apiDocsPrefix + config.docs.apiDocs + '\"'\n      );\n      fs.writeFileSync(\n        join(__dirname, \"../swagger-ui/index.html\"),\n        uiHtml,\n        \"utf8\"\n      );\n      if (!config.docs.swaggerUiPrefix) {\n        config.docs.swaggerUiPrefix = \"\";\n      }\n      app.use(\n        config.docs.swaggerUiPrefix + config.docs.swaggerUi,\n        express.static(join(__dirname, \"../swagger-ui\"))\n      );\n    }\n  }\n  config.pathsDict = dictionary;\n}\n\n/**\n * Function to initialize OAS-tools middlewares.\n *@param {object} oasDoc - Specification file.\n *@param {object} app - Express server used for the application. Needed to register the paths.\n *@param {function} callback - Function in which the app is started.\n */\nexport function initialize(oasDoc, app, callback) {\n  init_checks(oasDoc, callback);\n\n  var fullSchema = deref(oasDoc, { mergeAdditionalProperties: true });\n  config.logger.info(\"Specification file dereferenced\");\n\n  registerPaths(fullSchema, app);\n\n  callback();\n}\n\n/**\n * Function to initialize swagger-tools middlewares.\n *@param {object} specDoc - Specification file.\n *@param {function} app - //TODO IN CASE EXPRESS CAN BE USED INSTEAD OF CONNECT, USER MUST PASS THIS TO initializeMiddleware TO REGISTER ROUTES.\n *@param {function} callback - Function that initializes middlewares one by one.\n */\nexport function initializeMiddleware(specDoc, app, callback) {\n  app.use(\n    bodyParser.json({\n      strict: false,\n    })\n  );\n\n  init_checks(specDoc, callback);\n\n  var fullSchema = deref(specDoc);\n  config.logger.info(\"Specification file dereferenced\");\n\n  var middleware = {\n    swaggerValidator: EmptyMiddleware,\n    swaggerRouter: EmptyMiddleware,\n    swaggerMetadata: EmptyMiddleware,\n    swaggerUi: EmptyMiddleware,\n    swaggerSecurity: EmptyMiddleware,\n  };\n  registerPaths(fullSchema, app);\n  callback(middleware);\n}\n"],"mappings":"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"}