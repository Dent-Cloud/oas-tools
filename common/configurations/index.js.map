{"version":3,"file":"index.js","names":["_fs","_interopRequireDefault","require","_jsYaml","_path","_winston","obj","__esModule","default","config","setConfigurations","options","encoding","Error","configString","fs","readFileSync","newConfigurations","path","join","__dirname","jsyaml","safeLoad","process","env","NODE_ENV","err","console","log","controllers","undefined","cwd","c","setProperty","logger","createNewLogger","propertyName","newValue","exports","customFormat","winston","format","printf","info","timestamp","level","message","customLevels","levels","error","warn","custom","debug","colors","addColors","transports","Console","loglevel","handleExceptions","json","combine","colorize","splat","logfile","push","File","filename","maxsize","createLogger","exitOnError"],"sources":["../../src/configurations/index.js"],"sourcesContent":["/*!\nOAS-tools module 0.0.0, built on: 2017-03-30\nCopyright (C) 2017 Ignacio Peluaga Lozada (ISA Group)\nhttps://github.com/ignpelloz\nhttps://github.com/isa-group/project-oas-tools\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.*/\n\n/**\n * Module dependecies.\n * */\nimport fs from \"fs\";\nimport jsyaml from \"js-yaml\";\nimport path from \"path\";\nimport winston from \"winston\";\n\n/*\n * Export functions and Objects\n */\nexport const config = {\n  setConfigurations: function (options, encoding) {\n    if (!options) {\n      throw new Error(\"Configurations parameter is required\");\n    } else if (typeof options == \"string\") {\n      try {\n        var configString = fs.readFileSync(options, encoding);\n        var newConfigurations;\n        if (options === path.join(__dirname, \"configs.yaml\")) {\n          // default configurations loaded, only development and production environments are available\n          newConfigurations =\n            jsyaml.safeLoad(configString)[\n              process.env.NODE_ENV === \"production\"\n                ? \"production\"\n                : \"development\"\n            ];\n        } else {\n          newConfigurations =\n            jsyaml.safeLoad(configString)[\n              process.env.NODE_ENV || \"development\"\n            ];\n        }\n      } catch (err) {\n        console.log(\n          \"The specified configuration file wasn't found at \" +\n            options +\n            \".  Default configurations will be set\"\n        );\n        config.setConfigurations(path.join(__dirname, \"configs.yaml\"), \"utf8\");\n      }\n    } else {\n      newConfigurations = options;\n    }\n\n    if (newConfigurations.controllers == undefined) {\n      //TODO: Fix this!\n      newConfigurations.controllers = path.join(process.cwd(), \"./controllers\"); // for production (document that if no controller is specified then 'node' must be done wher /controllers is)\n    }\n    //If newConfigurations does indeed contain 'controllers', it will be initialized inside the following lop:\n    for (const c in newConfigurations) {\n      config.setProperty(c, newConfigurations[c]);\n      if (c == \"loglevel\") {\n        //loglevel changes, then new logger is needed\n        config.logger = createNewLogger();\n      } else if (c === \"customLogger\") {\n        config.setProperty(\"logger\", newConfigurations[c]);\n      }\n    }\n  },\n\n  setProperty: function (propertyName, newValue) {\n    config[propertyName] = newValue;\n  },\n};\n\n/**\n * Setup default configurations\n */\nconfig.setConfigurations(path.join(__dirname, \"configs.yaml\"), \"utf8\");\nconfig.logger = createNewLogger();\nfunction createNewLogger() {\n  var customFormat = winston.format.printf(\n    (info) => `${info.timestamp} ${info.level}: ${info.message}`\n  );\n\n  /**\n   * Configure here your custom levels.\n   */\n  var customLevels = {\n    levels: {\n      error: 7,\n      warn: 8,\n      custom: 9,\n      info: 10,\n      debug: 11,\n    },\n    colors: {\n      error: \"red\",\n      warn: \"yellow\",\n      custom: \"magenta\",\n      info: \"white\",\n      debug: \"blue\",\n    },\n  };\n\n  winston.addColors(customLevels.colors);\n  const transports = [\n    new winston.transports.Console({\n      level: config.loglevel,\n      handleExceptions: true,\n      json: false,\n      format: winston.format.combine(\n        winston.format.colorize(),\n        winston.format.timestamp(),\n        winston.format.splat(),\n        customFormat\n      ),\n    }),\n  ];\n  if (config.logfile != undefined) {\n    transports.push(\n      new winston.transports.File({\n        level: config.loglevel,\n        filename: config.logfile,\n        handleExceptions: true,\n        maxsize: 5242880, //5MB\n        format: winston.format.combine(\n          winston.format.timestamp(),\n          winston.format.splat(),\n          customFormat\n        ),\n      })\n    );\n  }\n  return winston.createLogger({\n    levels: customLevels.levels,\n    transports,\n    exitOnError: false,\n  });\n}\n"],"mappings":";;;;;;AAsBA,IAAAA,GAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,KAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,QAAA,GAAAJ,sBAAA,CAAAC,OAAA;AAA8B,SAAAD,uBAAAK,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAzB9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAMA;AACA;AACA;AACO,MAAMG,MAAM,GAAG;EACpBC,iBAAiB,EAAE,SAAAA,CAAUC,OAAO,EAAEC,QAAQ,EAAE;IAC9C,IAAI,CAACD,OAAO,EAAE;MACZ,MAAM,IAAIE,KAAK,CAAC,sCAAsC,CAAC;IACzD,CAAC,MAAM,IAAI,OAAOF,OAAO,IAAI,QAAQ,EAAE;MACrC,IAAI;QACF,IAAIG,YAAY,GAAGC,WAAE,CAACC,YAAY,CAACL,OAAO,EAAEC,QAAQ,CAAC;QACrD,IAAIK,iBAAiB;QACrB,IAAIN,OAAO,KAAKO,aAAI,CAACC,IAAI,CAACC,SAAS,EAAE,cAAc,CAAC,EAAE;UACpD;UACAH,iBAAiB,GACfI,eAAM,CAACC,QAAQ,CAACR,YAAY,CAAC,CAC3BS,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,GACjC,YAAY,GACZ,aAAa,CAClB;QACL,CAAC,MAAM;UACLR,iBAAiB,GACfI,eAAM,CAACC,QAAQ,CAACR,YAAY,CAAC,CAC3BS,OAAO,CAACC,GAAG,CAACC,QAAQ,IAAI,aAAa,CACtC;QACL;MACF,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZC,OAAO,CAACC,GAAG,CACT,mDAAmD,GACjDjB,OAAO,GACP,uCACJ,CAAC;QACDF,MAAM,CAACC,iBAAiB,CAACQ,aAAI,CAACC,IAAI,CAACC,SAAS,EAAE,cAAc,CAAC,EAAE,MAAM,CAAC;MACxE;IACF,CAAC,MAAM;MACLH,iBAAiB,GAAGN,OAAO;IAC7B;IAEA,IAAIM,iBAAiB,CAACY,WAAW,IAAIC,SAAS,EAAE;MAC9C;MACAb,iBAAiB,CAACY,WAAW,GAAGX,aAAI,CAACC,IAAI,CAACI,OAAO,CAACQ,GAAG,CAAC,CAAC,EAAE,eAAe,CAAC,CAAC,CAAC;IAC7E;IACA;IACA,KAAK,MAAMC,CAAC,IAAIf,iBAAiB,EAAE;MACjCR,MAAM,CAACwB,WAAW,CAACD,CAAC,EAAEf,iBAAiB,CAACe,CAAC,CAAC,CAAC;MAC3C,IAAIA,CAAC,IAAI,UAAU,EAAE;QACnB;QACAvB,MAAM,CAACyB,MAAM,GAAGC,eAAe,CAAC,CAAC;MACnC,CAAC,MAAM,IAAIH,CAAC,KAAK,cAAc,EAAE;QAC/BvB,MAAM,CAACwB,WAAW,CAAC,QAAQ,EAAEhB,iBAAiB,CAACe,CAAC,CAAC,CAAC;MACpD;IACF;EACF,CAAC;EAEDC,WAAW,EAAE,SAAAA,CAAUG,YAAY,EAAEC,QAAQ,EAAE;IAC7C5B,MAAM,CAAC2B,YAAY,CAAC,GAAGC,QAAQ;EACjC;AACF,CAAC;;AAED;AACA;AACA;AAFAC,OAAA,CAAA7B,MAAA,GAAAA,MAAA;AAGAA,MAAM,CAACC,iBAAiB,CAACQ,aAAI,CAACC,IAAI,CAACC,SAAS,EAAE,cAAc,CAAC,EAAE,MAAM,CAAC;AACtEX,MAAM,CAACyB,MAAM,GAAGC,eAAe,CAAC,CAAC;AACjC,SAASA,eAAeA,CAAA,EAAG;EACzB,IAAII,YAAY,GAAGC,gBAAO,CAACC,MAAM,CAACC,MAAM,CACrCC,IAAI,IAAM,GAAEA,IAAI,CAACC,SAAU,IAAGD,IAAI,CAACE,KAAM,KAAIF,IAAI,CAACG,OAAQ,EAC7D,CAAC;;EAED;AACF;AACA;EACE,IAAIC,YAAY,GAAG;IACjBC,MAAM,EAAE;MACNC,KAAK,EAAE,CAAC;MACRC,IAAI,EAAE,CAAC;MACPC,MAAM,EAAE,CAAC;MACTR,IAAI,EAAE,EAAE;MACRS,KAAK,EAAE;IACT,CAAC;IACDC,MAAM,EAAE;MACNJ,KAAK,EAAE,KAAK;MACZC,IAAI,EAAE,QAAQ;MACdC,MAAM,EAAE,SAAS;MACjBR,IAAI,EAAE,OAAO;MACbS,KAAK,EAAE;IACT;EACF,CAAC;EAEDZ,gBAAO,CAACc,SAAS,CAACP,YAAY,CAACM,MAAM,CAAC;EACtC,MAAME,UAAU,GAAG,CACjB,IAAIf,gBAAO,CAACe,UAAU,CAACC,OAAO,CAAC;IAC7BX,KAAK,EAAEpC,MAAM,CAACgD,QAAQ;IACtBC,gBAAgB,EAAE,IAAI;IACtBC,IAAI,EAAE,KAAK;IACXlB,MAAM,EAAED,gBAAO,CAACC,MAAM,CAACmB,OAAO,CAC5BpB,gBAAO,CAACC,MAAM,CAACoB,QAAQ,CAAC,CAAC,EACzBrB,gBAAO,CAACC,MAAM,CAACG,SAAS,CAAC,CAAC,EAC1BJ,gBAAO,CAACC,MAAM,CAACqB,KAAK,CAAC,CAAC,EACtBvB,YACF;EACF,CAAC,CAAC,CACH;EACD,IAAI9B,MAAM,CAACsD,OAAO,IAAIjC,SAAS,EAAE;IAC/ByB,UAAU,CAACS,IAAI,CACb,IAAIxB,gBAAO,CAACe,UAAU,CAACU,IAAI,CAAC;MAC1BpB,KAAK,EAAEpC,MAAM,CAACgD,QAAQ;MACtBS,QAAQ,EAAEzD,MAAM,CAACsD,OAAO;MACxBL,gBAAgB,EAAE,IAAI;MACtBS,OAAO,EAAE,OAAO;MAAE;MAClB1B,MAAM,EAAED,gBAAO,CAACC,MAAM,CAACmB,OAAO,CAC5BpB,gBAAO,CAACC,MAAM,CAACG,SAAS,CAAC,CAAC,EAC1BJ,gBAAO,CAACC,MAAM,CAACqB,KAAK,CAAC,CAAC,EACtBvB,YACF;IACF,CAAC,CACH,CAAC;EACH;EACA,OAAOC,gBAAO,CAAC4B,YAAY,CAAC;IAC1BpB,MAAM,EAAED,YAAY,CAACC,MAAM;IAC3BO,UAAU;IACVc,WAAW,EAAE;EACf,CAAC,CAAC;AACJ"}